{% extends "base.html" %}

{% block title %}Game Store – Products{% endblock %}

{% block content %}
  <h1>Available Games & Items</h1>

  {% if products %}
    <div class="auction-grid">
      {% for p in products %}
        <article class="auction-card">

          <!-- IMAGE AREA -->
          <a href="{% url 'product_detail' p.slug %}" class="auction-image">
            {% if p.image %}
              <img src="{{ p.image.url }}" alt="{{ p.name }}">
            {% elif p.image_url %}
              <img src="{{ p.image_url }}" alt="{{ p.name }}">
            {% else %}
              <div class="auction-image-placeholder">
                No image uploaded yet
              </div>
            {% endif %}
          </a>

          <!-- MAIN CONTENT -->
          <div class="auction-main">
            <header class="auction-card-header">
              <h2 class="auction-title">
                <a href="{% url 'product_detail' p.slug %}">
                  {{ p.name }}
                </a>
              </h2>
            </header>

            <div class="auction-body">
              {% if p.description %}
                <p class="auction-description">
                  {{ p.description|truncatewords:25 }}
                </p>
              {% else %}
                <p class="auction-description auction-description--muted">
                  No description provided yet.
                </p>
              {% endif %}
            </div>

            <!-- FOOTER -->
            <footer class="auction-card-footer">
              <div class="auction-footer-meta">
                <p class="auction-meta-line">
                  <span class="auction-meta-em">${{ p.price }}</span>
                  · Category: {{ p.category|default:"Uncategorized" }}
                </p>
                <p class="auction-meta-line">
                  In Stock: <span class="auction-meta-em">{{ p.inventory_qty }}</span>
                </p>
              </div>

              <div class="auction-footer-actions">
                <a href="{% url 'product_detail' p.slug %}"
                   class="btn btn-sm btn-secondary auction-details-btn">
                  View Details
                </a>

                <form method="post" action="{% url 'cart_add' p.id %}">
                  {% csrf_token %}
                  <button type="submit"
                          class="btn btn-sm btn-primary auction-details-btn">
                    Add to Cart
                  </button>
                </form>
              </div>
            </footer>
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p>No products yet. Log in as admin and add some!</p>
  {% endif %}
{% endblock %}
